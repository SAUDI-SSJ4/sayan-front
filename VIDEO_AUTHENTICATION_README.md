# تحديث نظام مصادقة الفيديوهات

تم تحديث مشغل الفيديو `CustomVideoPlayer` ليستخدم الـ API endpoint الجديد للوصول الآمن للفيديوهات.

## التغييرات المطبقة

### 1. نقطة النهاية الجديدة (API Endpoint)
```
{{base_url}}/website/videos/{{videoId}}/stream
```

### 2. طريقة المصادقة
- يتم إرسال الـ token كـ `Authorization Bearer` header في طلب التحقق الأولي
- يتم تمرير الـ token كـ query parameter في رابط الفيديو النهائي:
```
https://www.sayan-server.com/website/videos/{videoId}/stream?token={encoded_token}
```

### 3. الميزات المضافة
- **التحقق الأولي**: يتم التحقق من صلاحية الوصول للفيديو قبل التحميل
- **معالجة الأخطاء**: إدارة أفضل للأخطاء وحالات فشل التحميل
- **مؤشر التحميل**: عرض حالة التحميل للمستخدم
- **Cross-Origin Support**: دعم للفيديوهات من domains مختلفة

## كيفية العمل

1. **التحقق من الـ Token**: يتم التحقق من وجود `student_token` في الكوكيز
2. **طلب التحقق**: إرسال `HEAD` request للتأكد من صلاحية الوصول
3. **تحميل الفيديو**: في حالة النجاح، يتم تحميل الفيديو مع الـ token
4. **معالجة الأخطاء**: في حالة الفشل، يتم عرض رسالة خطأ

## الملفات المعدلة

- `src/pages/TrainingCourses/components/CustomVideoPlayer/index.jsx`

## ملاحظات مهمة

1. **الأمان**: يجب على الخادم التحقق من صلاحية الـ token في كل طلب
2. **الأداء**: استخدام `preload="metadata"` لتحسين الأداء
3. **التوافق**: يدعم جميع المتصفحات الحديثة
4. **التطوير المستقبلي**: يمكن إضافة طرق مصادقة أخرى حسب الحاجة

## استكشاف الأخطاء

### مشاكل شائعة:
1. **404 Error**: تحقق من صحة `videoId`
2. **401/403 Error**: تحقق من صلاحية الـ token
3. **CORS Error**: تأكد من إعدادات CORS على الخادم
4. **Network Error**: تحقق من الاتصال بالإنترنت

### الحلول:
- تحقق من console للحصول على تفاصيل الأخطاء
- تأكد من تسجيل دخول المستخدم
- تحقق من صلاحية الـ token

## مثال الاستخدام

```jsx
// في CourseDetails.jsx
<CustomVideoPlayer video={lesson.content.videoId} />

// بدلاً من
<CustomVideoPlayer video={lesson.content.videoUrl} />
```

الآن مشغل الفيديو سيأخذ `videoId` ويقوم ببناء URL المصادق تلقائياً. 